<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Word → Basic Markdown Converter</title>
  <style>
    :root { --bg:#0b0f14; --panel:#111823; --ink:#e7ecf3; --muted:#a9b4c1; --accent:#7cc5ff; }
    html,body { height:100%; }
    body { margin:0; font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif; color:var(--ink); background:linear-gradient(180deg,#0b0f14,#0d1520); overflow-x:hidden; }
    .wrap { max-width:1100px; width:min(1100px, 100% - 24px); margin:32px auto; padding:0 12px; }
    h1 { font-size:28px; margin:0 0 6px; }
    .sub { color:var(--muted); margin-bottom:20px; }
    .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(360px, 1fr)); gap:16px; }
    .panel { background:var(--panel); border:1px solid #1e2a3b; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35); overflow:hidden; display:flex; flex-direction:column; }
    .head { display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid #1b2434; position:relative; z-index:2; }
    .head h2 { margin:0; font-size:14px; letter-spacing:.6px; text-transform:uppercase; color:#c7d2e1; }
    .area { padding:12px; position:relative; z-index:1; flex:1; }

    /* Paste pane */
    #pasteArea { outline:none; }
    [contenteditable="true"] { cursor:text; }
    .editable { padding:12px 18px 12px 12px; background:#0e1624; border:1px solid #1e2a3b; border-radius:12px; min-height:260px; max-height:420px; overflow:auto; font-weight:400; color:var(--ink); overflow-wrap:anywhere; box-sizing:border-box; }
    .editable * { color:inherit; }
    .editable strong, .editable b { font-weight:700; }
    .editable em, .editable i { font-style:italic; }

    /* Markdown pane */
    textarea { width:100%; min-height:320px; max-height:420px; overflow:auto; resize:vertical; padding:12px 18px 12px 12px; border-radius:12px; border:1px solid #1e2a3b; background:#0e1624; color:var(--ink); font:14px/1.45 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; overflow-wrap:anywhere; box-sizing:border-box; }

    .toolbar { display:flex; flex-wrap:wrap; gap:10px; padding:12px; border-top:1px solid #1b2434; }
    .toolbar .group{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .sep{width:1px;height:28px;background:#1b2434;margin:0 6px}

    button { appearance:none; border:1px solid #28415f; background:#0f1c2e; color:var(--ink); padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:600; }
    button:hover { border-color:#335278; background:#12243a; }
    .ghost { opacity:.8; }
    .kbd { font:12px/1.2 ui-monospace, Menlo, Consolas, monospace; color:#b7c4d6; background:#0f1a29; padding:2px 6px; border:1px solid #20324b; border-radius:6px; }
    .note { color:#b6c3d3; font-size:13px; }
    .footer { margin-top:14px; color:#93a4b8; font-size:13px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Word → Basic Markdown Converter</h1>
    <p class="sub">Paste formatted text from Word/Google Docs on the left, then convert to <em>Basic Markdown</em> on the right. Handles headings, bold/italic, lists, links, images, blockquotes, code, and horizontal rules.</p>

    <div class="grid">
      <section class="panel" aria-label="input">
        <div class="head"><h2>Paste Here</h2><span class="note">Tip: paste rich HTML directly for best results.</span></div>
        <div class="area">
          <div id="pasteArea" class="editable" contenteditable="true" role="textbox" aria-multiline="true" aria-label="Paste source area"></div>
        </div>
        <div class="toolbar">
          <div class="group" aria-label="formatting controls">
            <button type="button" id="boldBtn" title="Bold (Ctrl/Cmd+B)"><b>B</b></button>
            <button type="button" id="italicBtn" title="Italic (Ctrl/Cmd+I)"><i>I</i></button>
            <span class="sep" aria-hidden="true"></span>
            <button type="button" id="h1Btn" title="Heading 1">H1</button>
            <button type="button" id="h2Btn" title="Heading 2">H2</button>
            <button type="button" id="h3Btn" title="Heading 3">H3</button>
            <button type="button" id="ulBtn" title="Bulleted list">• List</button>
            <button type="button" id="olBtn" title="Numbered list">1. List</button>
            <button type="button" id="quoteBtn" title="Blockquote">“” Quote</button>
            <span class="sep" aria-hidden="true"></span>
            <button type="button" id="clearFormatBtn" class="ghost" title="Remove inline formatting">Clear formatting</button>
          </div>
          <div class="group" aria-label="cleanup tools">
            <button type="button" id="findBtn" title="Find & Replace">Find/Replace</button>
            <button type="button" id="normalizeBtn" class="ghost" title="Straighten quotes, dashes, ellipses, NBSP">Normalize punctuation</button>
            <button type="button" id="collapseBtn" class="ghost" title="Collapse extra spaces and blank lines">Collapse whitespace</button>
            <button type="button" id="unwrapBtn" class="ghost" title="Turn soft line breaks into spaces">Unwrap lines</button>
            <button type="button" id="fixBulletsBtn" title="Convert middle-dot bullets (·, •, ◦) into a real list">Make bullets (· → •)</button>
            <button type="button" id="stripDotBtn" class="ghost" title="Remove all middle dots (·) anywhere in the paste area">Strip · (everywhere)</button>
            <span class="sep" aria-hidden="true"></span>
            <button type="button" id="pasteBtn" title="Paste (Ctrl/Cmd+V)">Paste</button>
            <button type="button" id="clearBtn" class="ghost" title="Clear input">Clear</button>
            <span class="note">or drop HTML/text here</span>
          </div>
        </div>
      </section>

      <section class="panel" aria-label="output">
        <div class="head"><h2>Markdown (Basic)</h2><span class="note">Plain text output</span></div>
        <div class="area">
          <textarea id="mdOut" placeholder="# Your Markdown will appear here…" aria-label="Markdown output"></textarea>
        </div>
        <div class="toolbar">
          <button type="button" id="convertBtn" title="Convert (Ctrl/Cmd+Enter)">Convert</button>
          <button type="button" id="copyBtn" class="ghost" title="Copy to clipboard">Copy</button>
          <button type="button" id="downloadBtn" class="ghost" title="Download .md file">Download .md</button>
        </div>
      </section>
    </div>

    <p class="footer">Shortcuts: <span class="kbd">Ctrl/Cmd+Enter</span> convert · <span class="kbd">Ctrl/Cmd+C</span> copy selection · Paste handler maps inline styles (e.g., <span class="kbd">font-weight:700</span>) to semantic tags so the left pane doesn’t render all-bold.</p>
  </div>

  <script>
    // --- DOM helpers --------------------------------------------------------
    const $ = (sel) => document.querySelector(sel);
    const pasteArea = $('#pasteArea');
    const mdOut = $('#mdOut');

    // Keep selection when clicking toolbar buttons
    let lastRange = null;
    function saveSel(){ const s=window.getSelection(); if(s && s.rangeCount && pasteArea.contains(s.anchorNode)) lastRange=s.getRangeAt(0).cloneRange(); }
    function restoreSel(){ const s=window.getSelection(); if(lastRange){ s.removeAllRanges(); s.addRange(lastRange); } }
    ['keyup','mouseup'].forEach(e=> pasteArea.addEventListener(e, saveSel));
    document.addEventListener('selectionchange', saveSel);
    document.querySelectorAll('.toolbar button').forEach(b=> b.addEventListener('mousedown', e=> e.preventDefault()));

    // --- Text normalization -------------------------------------------------
    function normalizeText(s){
      return (s||'')
        .replace(/[\u2018\u2019\u201B]/g,"'")
        .replace(/[\u201C\u201D\u201F]/g,'"')
        .replace(/[\u2013]/g,'-')
        .replace(/[\u2014]/g,'--')
        .replace(/[\u2026]/g,'...')
        .replace(/\u00A0/g,' ');
    }

    // --- Paste pipeline ----------------------------------------------------
    function applyInlineStyleTags(root){
      root.querySelectorAll('[style]').forEach(el=>{
        const st=(el.getAttribute('style')||'').toLowerCase();
        const bold=/font-weight\s*:\s*(bold|[6-9]00)/.test(st);
        const italic=/font-style\s*:\s*italic/.test(st);
        if(!(bold||italic)) return;
        const frag=document.createDocumentFragment(); while(el.firstChild) frag.appendChild(el.firstChild);
        let node=frag; if(italic){ const em=document.createElement('em'); em.appendChild(node); node=em; }
        if(bold){ const strong=document.createElement('strong'); strong.appendChild(node); node=strong; }
        el.parentNode.insertBefore(node, el); el.remove();
      });
    }
    function unwrapStrongBlocks(root){
      root.querySelectorAll('strong,b').forEach(s=>{
        const hasBlock=Array.from(s.childNodes).some(n=>n.nodeType===1 && /^(P|DIV|UL|OL|H[1-6])$/.test(n.tagName));
        if(hasBlock){ while(s.firstChild) s.parentNode.insertBefore(s.firstChild,s); s.remove(); }
      });
    }
    function deboldFullBlocks(root){
      root.querySelectorAll('p,div,span').forEach(block=>{
        if(block.closest('h1,h2,h3,ul,ol')) return;
        const onlyChild=block.childNodes.length===1 && block.firstChild?.nodeType===1;
        const tag=onlyChild?block.firstChild.tagName:'';
        if(onlyChild && (tag==='STRONG'||tag==='B')){
          const st=block.firstChild; while(st.firstChild) block.insertBefore(st.firstChild,st); st.remove();
        }
      });
    }
    function sanitize(root){
      const forbidden=['SCRIPT','STYLE','NOSCRIPT'];
      const w=document.createTreeWalker(root,NodeFilter.SHOW_ELEMENT,null);
      const rm=[]; while(w.nextNode()){ const n=w.currentNode; if(forbidden.includes(n.tagName)) rm.push(n); n.removeAttribute('style'); n.removeAttribute('class'); n.removeAttribute('id'); }
      rm.forEach(n=>n.remove());
    }

    pasteArea.addEventListener('paste', (e)=>{
      const html=e.clipboardData?.getData('text/html');
      const text=e.clipboardData?.getData('text/plain');
      try{
        if(html){
          e.preventDefault();
          const doc=new DOMParser().parseFromString(html,'text/html');
          applyInlineStyleTags(doc.body); // keep bold/italic
          unwrapStrongBlocks(doc.body);   // avoid nested strong blocks
          sanitize(doc.body);
          deboldFullBlocks(doc.body);     // prevent “all bold” look
          pasteArea.innerHTML=doc.body.innerHTML;
        } else if(text){ setTimeout(()=>{ pasteArea.textContent=normalizeText(text); },0); }
      }catch(err){ setTimeout(()=>{ pasteArea.textContent=normalizeText(text||''); },0); }
    });

    // Drag/drop
    ['dragover','dragenter'].forEach(evt=> pasteArea.addEventListener(evt,e=>{ e.preventDefault(); e.dataTransfer.dropEffect='copy'; }));
    pasteArea.addEventListener('drop', (e)=>{
      e.preventDefault(); const f=e.dataTransfer.files?.[0]; if(!f) return;
      const r=new FileReader(); r.onload=()=>{ const c=r.result+''; if(/<\w+/.test(c)){ const d=new DOMParser().parseFromString(c,'text/html'); applyInlineStyleTags(d.body); unwrapStrongBlocks(d.body); sanitize(d.body); deboldFullBlocks(d.body); pasteArea.innerHTML=d.body.innerHTML; } else { pasteArea.textContent=normalizeText(c); } }; r.readAsText(f);
    });

    // --- Converters --------------------------------------------------------
    function htmlToMarkdown(root){
      const blocks=new Set(['P','DIV','SECTION','ARTICLE','HEADER','FOOTER','ASIDE','MAIN','FIGURE']);
      const rep=(ch,n)=>new Array(n+1).join(ch);
      const txt=(n)=>normalizeText(n.textContent||'');
      function walk(node,ctx={indent:0}){
        if(node.nodeType===3){ return (txt(node)).replace(/\s+/g,' '); }
        if(node.nodeType!==1) return '';
        const tag=node.tagName;
        const kids=(c=ctx)=>Array.from(node.childNodes).map(n=>walk(n,c)).join('');
        const strong=(s)=>s?`**${s.trim()}**`:''; const em=(s)=>s?`*${s.trim()}*`:'';
        switch(tag){
          case 'H1':case 'H2':case 'H3':case 'H4':case 'H5':case 'H6':{ const lvl=parseInt(tag[1],10); return `\n${rep('#',lvl)} ${kids().trim()}\n\n`; }
          case 'BR': return '\n';
          case 'HR': return '\n\n---\n\n';
          case 'STRONG':case 'B': return strong(kids());
          case 'EM':case 'I': return em(kids());
          case 'A':{ const href=(node.getAttribute('href')||'').trim(); const t=kids().trim()||href; return href?`[${t}](${href})`:t; }
          case 'IMG':{ const alt=node.getAttribute('alt')||''; const src=node.getAttribute('src')||''; return src?`![${alt}](${src})`:''; }
          case 'BLOCKQUOTE':{ const inner=kids(); return '\n'+inner.split(/\n/).map(l=>l?'> '+l:'>').join('\n')+'\n\n'; }
          case 'UL':{ const items=Array.from(node.children).filter(li=>li.tagName==='LI'); const out=items.map(li=>liMD(li,ctx.indent,'- ')).join(''); return `\n${out}\n`; }
          case 'OL':{ const start=parseInt(node.getAttribute('start')||'1',10); const items=Array.from(node.children).filter(li=>li.tagName==='LI'); const out=items.map((li,i)=>liMD(li,ctx.indent,`${start+i}. `)).join(''); return `\n${out}\n`; }
          default:{ const content=kids(); if(blocks.has(tag)) return `\n${content.trim()}\n\n`; return content; }
        }
        function liMD(li,base,bullet){
          const subs=Array.from(li.children).filter(ch=>ch.tagName==='UL'||ch.tagName==='OL');
          const first=Array.from(li.childNodes).filter(n=>!(n.nodeType===1&&(n.tagName==='UL'||n.tagName==='OL')));
          const inner=first.map(n=>walk(n,{...ctx,indent:base})).join('').trim();
          let line=' '.repeat(base)+bullet+inner+'\n'; subs.forEach(s=> line+=walk(s,{...ctx,indent:base+2})); return line;
        }
      }
      return cleanupMD(walk(root));
    }
    function cleanupMD(md){ return md.replace(/\n{3,}/g,'\n\n').replace(/[ \t]+\n/g,'\n').replace(/^\s+|\s+$/g,'')+'\n'; }

    function convertNow(){
      const html=pasteArea.innerHTML.trim(); let md='';
      if(html){ const div=document.createElement('div'); div.innerHTML=html; md=htmlToMarkdown(div); }
      else { md=cleanupMD(normalizeText(pasteArea.textContent||'')); }
      mdOut.value=md; mdOut.focus();
    }

    // --- Bullet helpers ----------------------------------------------------
    function makeBulletsReal(){
      const BULLET=/^[\s]*([•·◦])\s*/; // fake bullets
      const children=Array.from(pasteArea.childNodes); let run=[];
      function flush(){ if(!run.length) return; const ul=document.createElement('ul'); const first=run[0]; pasteArea.insertBefore(ul,first); run.forEach(p=>{ const li=document.createElement('li'); li.innerHTML=(p.innerHTML||'').replace(BULLET,'').trim(); ul.appendChild(li); p.remove(); }); run=[]; }
      children.forEach(n=>{ if(n.nodeType===1 && (n.tagName==='P'||n.tagName==='DIV')){ const t=(n.textContent||'').trim(); if(BULLET.test(t)){ run.push(n); return; } } flush(); }); flush();
      // also handle <br>-separated bullets within a single block
      pasteArea.querySelectorAll('p,div').forEach(block=>{ const parts=block.innerHTML.split(/<br\s*\/?>(?:\s*)/i); if(parts.length<=1) return; const bulletLines=parts.filter(l=>BULLET.test(l.replace(/<[^>]+>/g,''))); if(bulletLines.length>=2){ const ul=document.createElement('ul'); parts.forEach(line=>{ const plain=line.replace(/<[^>]+>/g,''); if(BULLET.test(plain)){ const li=document.createElement('li'); li.innerHTML=line.replace(BULLET,'').trim(); ul.appendChild(li); } else if(plain.trim()){ const p=document.createElement('p'); p.innerHTML=line; block.parentNode.insertBefore(p,block); } }); block.replaceWith(ul); } });
    }
    function stripDotsEverywhere(){
      // Remove literal · (U+00B7) and &middot; plus trailing spaces/NBSPs
      const RE_TEXT=/[\u00B7]+[\s\u00A0]*/g; const RE_ENTITY=/(?:&middot;)+[\s\u00A0]*/gi;
      const w=document.createTreeWalker(pasteArea,NodeFilter.SHOW_TEXT,null); const ns=[]; while(w.nextNode()) ns.push(w.currentNode);
      ns.forEach(n=> n.nodeValue=(n.nodeValue||'').replace(RE_TEXT,''));
      pasteArea.innerHTML=pasteArea.innerHTML.replace(RE_ENTITY,'');
    }

    // --- Simple Find/Replace ----------------------------------------------
    function escRe(s){ return s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); }
    function replaceInTextNodes(root,rx,repl){ const w=document.createTreeWalker(root,NodeFilter.SHOW_TEXT,null); const ns=[]; while(w.nextNode()) ns.push(w.currentNode); ns.forEach(n=> n.nodeValue=(n.nodeValue||'').replace(rx,repl)); }
    function findReplace(){ const q=prompt('Find text:',''); if(q===null||q==='') return; const r=prompt('Replace with:',''); if(r===null) return; const cs=confirm('Match case?\nOK = case-sensitive, Cancel = case-insensitive'); const rx=new RegExp(escRe(q), cs?'g':'gi'); replaceInTextNodes(pasteArea,rx,r); }

    // --- Buttons -----------------------------------------------------------
    function exec(cmd,val=null){ restoreSel(); document.execCommand(cmd,false,val); pasteArea.focus(); saveSel(); }
    $('#boldBtn').addEventListener('click', ()=>exec('bold'));
    $('#italicBtn').addEventListener('click', ()=>exec('italic'));
    $('#h1Btn').addEventListener('click', ()=>exec('formatBlock','H1'));
    $('#h2Btn').addEventListener('click', ()=>exec('formatBlock','H2'));
    $('#h3Btn').addEventListener('click', ()=>exec('formatBlock','H3'));
    $('#ulBtn').addEventListener('click', ()=>exec('insertUnorderedList'));
    $('#olBtn').addEventListener('click', ()=>exec('insertOrderedList'));
    $('#quoteBtn').addEventListener('click', ()=>exec('formatBlock','BLOCKQUOTE'));
    $('#clearFormatBtn').addEventListener('click', ()=>exec('removeFormat'));

    $('#normalizeBtn').addEventListener('click', ()=>{ const w=document.createTreeWalker(pasteArea,NodeFilter.SHOW_TEXT,null); const ns=[]; while(w.nextNode()) ns.push(w.currentNode); ns.forEach(n=> n.nodeValue=normalizeText(n.nodeValue||'')); pasteArea.focus(); });
    $('#collapseBtn').addEventListener('click', ()=>{ const w=document.createTreeWalker(pasteArea,NodeFilter.SHOW_TEXT,null); const ns=[]; while(w.nextNode()) ns.push(w.currentNode); ns.forEach(n=> n.nodeValue=(n.nodeValue||'').replace(/[\t ]+/g,' ').replace(/\s*\n\s*/g,'\n')); pasteArea.querySelectorAll('p,span,div').forEach(x=>{ if(!(x.textContent||'').trim()) x.remove(); }); pasteArea.focus(); });
    $('#unwrapBtn').addEventListener('click', ()=>{ pasteArea.querySelectorAll('br').forEach(br=> br.replaceWith(' ')); const w=document.createTreeWalker(pasteArea,NodeFilter.SHOW_TEXT,null); const ns=[]; while(w.nextNode()) ns.push(w.currentNode); ns.forEach(n=> n.nodeValue=(n.nodeValue||'').replace(/\s*\n\s*/g,' ')); pasteArea.focus(); });

    $('#findBtn').addEventListener('click', findReplace);
    $('#fixBulletsBtn').addEventListener('click', ()=>{ makeBulletsReal(); pasteArea.focus(); });
    $('#stripDotBtn').addEventListener('click', ()=>{ stripDotsEverywhere(); pasteArea.focus(); });

    $('#convertBtn').addEventListener('click', convertNow);
    $('#pasteBtn').addEventListener('click', async ()=>{ try{ const t=await navigator.clipboard.readText(); if(t){ pasteArea.textContent=normalizeText(t); } }catch(e){ pasteArea.focus(); } });
    $('#clearBtn').addEventListener('click', ()=>{ pasteArea.innerHTML=''; mdOut.value=''; pasteArea.focus(); saveSel(); });

    $('#copyBtn').addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(mdOut.value||''); }catch(_){} });
    $('#downloadBtn').addEventListener('click', ()=>{ const blob=new Blob([mdOut.value||''],{type:'text/markdown'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='converted.md'; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(a.href),800); });

    document.addEventListener('keydown', (e)=>{ if((e.ctrlKey||e.metaKey) && e.key==='Enter'){ e.preventDefault(); convertNow(); }});
  </script>
</body>
</html>
